<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.enn.energy.system.dao.SteamInfoMapper">
    
    <resultMap id="steamInfo" type="com.enn.vo.energy.system.SteamInfo">
        <id column="id" property="id"/>
        <result column="cust_id" property="custId"/>
        <result column="unit" property="unit"/>
        <result column="basic_price" property="basicPrice"/>
        <result column="start_execute_date" property="startExecuteDate"/>
        <result column="is_single_price" property="isSinglePrice"/>
    </resultMap>
    
    <resultMap id="steamLadderPrice" type="com.enn.vo.energy.system.SteamLadderPrice">
        <id column="id" property="id"/>
        <result column="steam_id" property="steamId"/>
        <result column="start_value" property="startValue"/>
        <result column="end_value" property="endValue"/>
        <result column="steam_price" property="steamPrice"/>
    </resultMap>

    <insert id="addSteamInfo" parameterType="com.enn.vo.energy.system.SteamInfo" useGeneratedKeys="true" keyProperty="id">
        insert into steam_info(cust_id,unit,basic_price,start_execute_date,is_single_price)
        values(#{custId},#{unit},#{basicPrice},#{startExecuteDate},#{isSinglePrice})
    </insert>

    <insert id="addSteamLadderPrice">
        insert into steam_ladder_price(steam_id,start_value,end_value,steam_price)
        values(#{steamId},#{startValue},#{endValue},#{steamPrice})
    </insert>

    <update id="updateSteamInfo">
        update steam_info
        set unit=#{unit},basic_price=#{basicPrice},start_execute_date=#{startExecuteDate},is_single_price=#{isSinglePrice}
        where id = #{id}
    </update>

    <update id="updateSteamLadderPrice">
        update steam_ladder_price
        set start_value=#{startValue},end_value=#{endValue},steam_price=#{steamPrice}
        where id = #{id}
    </update>

    <update id="delSteamInfo">
        update steam_info set del_flag='1' where id=#{id}
    </update>

    <update id="delSteamLadderPrice">
        update steam_ladder_price set del_flag='1' where steam_id=#{steamId}
    </update>

    <select id="getSteamInfoOne" resultMap="steamInfo">
        select id,cust_id,unit,basic_price,start_execute_date,is_single_price
        from steam_info where id = #{id} and del_flag = '0'
    </select>

    <select id="getSteamInfoList" resultMap="steamInfo">
         select id,cust_id,unit,basic_price,start_execute_date,is_single_price
         from steam_info
         where cust_id = #{custId}
        <if test="startExecuteDate != null and startExecuteDate != ''" >
            and start_execute_date >= #{startExecuteDate}
        </if>
        and del_flag = '0'
        order by start_execute_date desc
    </select>

    <select id="getSteamLadderPrices" resultMap="steamLadderPrice">
          select id,steam_id,start_value,end_value,steam_price
          from steam_ladder_price
          where steam_id = #{steamId} and del_flag = '0'
          order by start_value asc
    </select>
</mapper>